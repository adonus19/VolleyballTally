import{$ as v,X as c,_ as y,a as u,g as f,qa as p}from"./chunk-TYSMPCN6.js";var o=[];for(let s=0;s<256;++s)o.push((s+256).toString(16).slice(1));function S(s,t=0){return(o[s[t+0]]+o[s[t+1]]+o[s[t+2]]+o[s[t+3]]+"-"+o[s[t+4]]+o[s[t+5]]+"-"+o[s[t+6]]+o[s[t+7]]+"-"+o[s[t+8]]+o[s[t+9]]+"-"+o[s[t+10]]+o[s[t+11]]+o[s[t+12]]+o[s[t+13]]+o[s[t+14]]+o[s[t+15]]).toLowerCase()}var l,E=new Uint8Array(16);function g(){if(!l){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(E)}var w=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),h={randomUUID:w};function b(s,t,e){if(h.randomUUID&&!t&&!s)return h.randomUUID();s=s||{};let i=s.random??s.rng?.()??g();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){if(e=e||0,e<0||e+16>t.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let n=0;n<16;++n)t[e+n]=i[n];return t}return S(i)}var d=b;var m=class s{get(t,e){let i=localStorage.getItem(t);return i&&(e=JSON.parse(i)),e}set(t,e){localStorage.setItem(t,JSON.stringify(e))}static \u0275fac=function(e){return new(e||s)};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};var x=class s{constructor(t){this.storage=t}players=p([]);sessions=p([]);settings=p({teamPrimary:"#3880ff",teamSecondary:"#5260ff",darkMode:!1,winnersCount:3});init(){this.players.set(this.storage.get("players",[])),this.sessions.set(this.storage.get("sessions",[])),this.settings.set(this.storage.get("settings",this.settings()))}persist(){this.storage.set("players",this.players()),this.storage.set("sessions",this.sessions()),this.storage.set("settings",this.settings())}addPlayer(t,e){let i={id:d(),name:t.trim(),number:e?.trim()||void 0};this.players.update(n=>[...n,i]),this.persist()}updatePlayer(t){this.players.update(e=>e.map(i=>i.id===t.id?t:i)),this.persist()}deletePlayer(t){this.players.update(e=>e.filter(i=>i.id!==t)),this.persist()}addSession(t,e,i=new Date().toISOString()){let n={id:d(),type:t,date:i,title:e?.trim()||void 0,points:[]};return this.sessions.update(r=>[n,...r]),this.persist(),n.id}updateSession(t){this.sessions.update(e=>e.map(i=>i.id===t.id?t:i)),this.persist()}deleteSession(t){this.sessions.update(e=>e.filter(i=>i.id!==t)),this.persist()}awardPoint(t,e,i){let n=this.sessions().find(a=>a.id===t);if(console.log("session",n),!n)return;let r={id:d(),playerId:e,timestamp:Date.now(),note:i?.slice(0,100)||void 0};console.log("entry",r),n.points=[...n.points,r],console.log("points",n.points),this.updateSession(n)}decrementPoint(t,e){let i=this.sessions().find(a=>a.id===t);if(!i)return;let n=[...i.points].reverse().findIndex(a=>a.playerId===e);if(n===-1)return;let r=i.points.length-1-n;i.points.splice(r,1),this.updateSession(i)}getSessionCounts(t){let e=new Map;for(let i of t.points)e.set(i.playerId,(e.get(i.playerId)??0)+1);return e}getFirstPointTimeByPlayer(t){let e=new Map;for(let i of t.points)e.has(i.playerId)||e.set(i.playerId,i.timestamp);return e}getTopForSession(t,e){let i=this.getSessionCounts(t),n=this.getFirstPointTimeByPlayer(t);return[...i.entries()].map(([r,a])=>({playerId:r,count:a,firstTs:n.get(r)??Number.MAX_SAFE_INTEGER})).sort((r,a)=>a.count-r.count||r.firstTs-a.firstTs).slice(0,Math.max(0,e))}getTotals(){let t=new Map;for(let e of this.sessions())for(let i of e.points)t.set(i.playerId,(t.get(i.playerId)??0)+1);return[...t.entries()].map(([e,i])=>({playerId:e,count:i})).sort((e,i)=>i.count-e.count)}setSettings(t){this.settings.update(e=>u(u({},e),t)),this.persist()}static \u0275fac=function(e){return new(e||s)(v(m))};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};function z(s){return s&&typeof s.connect=="function"&&!(s instanceof f)}var D=(function(s){return s[s.REPLACED=0]="REPLACED",s[s.INSERTED=1]="INSERTED",s[s.MOVED=2]="MOVED",s[s.REMOVED=3]="REMOVED",s})(D||{}),J=new y("_ViewRepeater");export{x as a,z as b,D as c,J as d};
